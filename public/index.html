<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>TEZ FM - Tezos NFT Radio</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="TEZ FM - Your personal Tezos NFT radio station. Stream music NFTs from Objkt.com with lock screen controls and background playback.">
    <meta name="theme-color" content="#ffd700">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="TEZ FM">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://tezfm.xyz/">
    <meta property="og:title" content="TEZ FM - Tezos NFT Radio">
    <meta property="og:description" content="üéµ Stream your Tezos music NFTs with retrowave style. Lock screen controls, playlists, and audio visualization. The radio station for Tezos audio NFTs.">
    <meta property="og:image" content="https://tezfm.xyz/social-card.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://tezfm.xyz/">
    <meta property="twitter:title" content="TEZ FM - Tezos NFT Radio">
    <meta property="twitter:description" content="üéµ Stream your Tezos music NFTs with retrowave style. Lock screen controls, playlists, and audio visualization. The radio station for Tezos audio NFTs.">
    <meta property="twitter:image" content="https://tezfm.xyz/social-card.png">
    
    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="icon-16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icon-32.png">
    <link rel="icon" type="image/png" sizes="48x48" href="icon-48.png">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icon-152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');

        body {
            font-family: 'Orbitron', 'Arial Black', sans-serif;
            background: #000000;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px 15px;
            position: relative;
            overflow-x: hidden;
            overflow-y: auto;
        }

        /* Animated vaporwave grid background */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(0deg, transparent 24%, rgba(255, 215, 0, 0.08) 25%, rgba(255, 215, 0, 0.08) 26%, transparent 27%, transparent 74%, rgba(255, 215, 0, 0.08) 75%, rgba(255, 215, 0, 0.08) 76%, transparent 77%, transparent),
                linear-gradient(90deg, transparent 24%, rgba(255, 110, 199, 0.06) 25%, rgba(255, 110, 199, 0.06) 26%, transparent 27%, transparent 74%, rgba(255, 110, 199, 0.06) 75%, rgba(255, 110, 199, 0.06) 76%, transparent 77%, transparent);
            background-size: 60px 60px;
            background-position: 0 0;
            transform: perspective(600px) rotateX(60deg) translateZ(0);
            transform-origin: center bottom;
            animation: gridMove 25s linear infinite;
            opacity: 0.4;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes gridMove {
            0% { background-position: 0 0; }
            100% { background-position: 0 60px; }
        }

        /* Subtle top gradient glow */
        body::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(ellipse at top, rgba(255, 215, 0, 0.05) 0%, transparent 40%),
                radial-gradient(ellipse at center, rgba(255, 110, 199, 0.03) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        /* Scanlines effect */
        .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                0deg,
                rgba(255, 215, 0, 0.02) 0px,
                transparent 1px,
                transparent 2px,
                rgba(255, 110, 199, 0.02) 3px
            );
            pointer-events: none;
            z-index: 1;
            animation: scanlineMove 10s linear infinite;
        }

        @keyframes scanlineMove {
            0% { transform: translateY(0); }
            100% { transform: translateY(4px); }
        }

        .container {
            width: 100%;
            max-width: 420px;
            max-height: none;
            perspective: 1500px;
            position: relative;
            z-index: 10;
        }
        
        @media (max-height: 800px) {
            .container {
                max-width: 380px;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                max-width: 100%;
                padding: 0 5px;
            }
        }

        .walkman {
            background: 
                linear-gradient(145deg, rgba(10, 10, 10, 0.95), rgba(20, 20, 30, 0.9));
            border-radius: 28px;
            padding: 20px 20px 18px 20px;
            box-shadow: 
                0 30px 80px rgba(0, 0, 0, 0.8),
                0 15px 40px rgba(255, 215, 0, 0.2),
                inset 0 -8px 25px rgba(0, 0, 0, 0.6),
                inset 0 8px 25px rgba(255, 215, 0, 0.1),
                inset 2px 0 15px rgba(255, 215, 0, 0.15),
                inset -2px 0 15px rgba(255, 110, 199, 0.1);
            position: relative;
            border: 3px solid rgba(255, 215, 0, 0.3);
            transform: translateZ(0);
            transition: all 0.3s ease;
            backdrop-filter: blur(20px);
            overflow: hidden;
        }
        
        @media (max-width: 480px) {
            .walkman {
                padding: 15px 15px 15px 15px;
                border-radius: 20px;
                border-width: 2px;
            }
        }

        /* Animated vaporwave grid INSIDE the player */
        .walkman::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(0deg, transparent 24%, rgba(255, 215, 0, 0.25) 25%, rgba(255, 215, 0, 0.25) 26%, transparent 27%, transparent 74%, rgba(255, 215, 0, 0.25) 75%, rgba(255, 215, 0, 0.25) 76%, transparent 77%, transparent),
                linear-gradient(90deg, transparent 24%, rgba(255, 110, 199, 0.2) 25%, rgba(255, 110, 199, 0.2) 26%, transparent 27%, transparent 74%, rgba(255, 110, 199, 0.2) 75%, rgba(255, 110, 199, 0.2) 76%, transparent 77%, transparent);
            background-size: 35px 35px;
            background-position: 0 0;
            transform: perspective(300px) rotateX(55deg) scale(2) translateY(-80px);
            transform-origin: center center;
            animation: innerGridMove 8s linear infinite, gridPulse 2s ease-in-out infinite;
            opacity: var(--grid-opacity, 0.5);
            border-radius: 28px;
            pointer-events: none;
            z-index: 0;
            filter: blur(0.3px);
        }

        @keyframes innerGridMove {
            0% { background-position: 0 0; }
            100% { background-position: 0 35px; }
        }

        @keyframes gridPulse {
            0%, 100% { 
                opacity: var(--grid-opacity, 0.5);
                transform: perspective(300px) rotateX(55deg) scale(var(--grid-scale, 2)) translateY(-80px);
            }
            50% { 
                opacity: calc(var(--grid-opacity, 0.5) * 1.3);
                transform: perspective(300px) rotateX(55deg) scale(calc(var(--grid-scale, 2) * 1.05)) translateY(-80px);
            }
        }

        /* Radiant glow layer */
        .walkman-glow {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            transform: translate(-50%, -50%);
            background: 
                radial-gradient(ellipse at center, rgba(255, 215, 0, var(--glow-intensity, 0.15)) 0%, transparent 60%),
                radial-gradient(ellipse at center, rgba(255, 110, 199, var(--glow-intensity, 0.1)) 20%, transparent 70%);
            border-radius: 28px;
            pointer-events: none;
            z-index: 0;
            animation: glowPulse 2s ease-in-out infinite;
        }

        @keyframes glowPulse {
            0%, 100% { 
                opacity: 1; 
                transform: translate(-50%, -50%) scale(1);
            }
            50% { 
                opacity: 1.3; 
                transform: translate(-50%, -50%) scale(1.08);
            }
        }

        /* Audio reactive glow layer */
        .walkman::after {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            background: transparent;
            border-radius: 32px;
            pointer-events: none;
            z-index: -1;
            transition: box-shadow 0.1s ease;
        }

        .walkman.audio-react::after {
            animation: audio-pulse 0.1s ease;
        }

        @keyframes audio-pulse {
            0% { 
                box-shadow: 
                    0 0 30px rgba(255, 215, 0, 0.4),
                    0 0 60px rgba(255, 215, 0, 0.2),
                    inset 0 0 30px rgba(255, 215, 0, 0.1);
            }
            50% { 
                box-shadow: 
                    0 0 60px rgba(255, 215, 0, 0.8),
                    0 0 120px rgba(255, 110, 199, 0.4),
                    inset 0 0 60px rgba(255, 215, 0, 0.2);
            }
            100% { 
                box-shadow: 
                    0 0 30px rgba(255, 215, 0, 0.4),
                    0 0 60px rgba(255, 215, 0, 0.2),
                    inset 0 0 30px rgba(255, 215, 0, 0.1);
            }
        }

        .walkman:hover {
            transform: translateZ(10px);
            box-shadow: 
                0 35px 90px rgba(0, 0, 0, 0.9),
                0 20px 50px rgba(255, 215, 0, 0.3),
                inset 0 -8px 25px rgba(0, 0, 0, 0.6),
                inset 0 8px 25px rgba(255, 215, 0, 0.15);
        }

        /* Make sure all content is above the background layers */
        .walkman > * {
            position: relative;
            z-index: 1;
        }

        /* Remove top clips */
        .top-clips {
            display: none;
        }

        .clip {
            display: none;
        }

        /* Remove side buttons */
        .side-btn {
            display: none;
        }

        /* Logo */
        .logo {
            text-align: right;
            font-size: 18px;
            font-weight: 900;
            letter-spacing: 2px;
            color: #ffd700;
            margin-bottom: 20px;
            font-family: 'Orbitron', sans-serif;
            text-shadow: 
                0 0 20px rgba(255, 215, 0, 0.8),
                0 0 40px rgba(255, 215, 0, 0.4),
                2px 2px 4px rgba(0, 0, 0, 0.8);
        }
        
        @media (max-width: 480px) {
            .logo {
                font-size: 16px;
                margin-bottom: 15px;
            }
        }

        /* Status LEDs */
        .status-leds {
            position: absolute;
            top: 30px;
            left: 30px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        @media (max-width: 480px) {
            .status-leds {
                top: 20px;
                left: 20px;
                gap: 8px;
            }
        }

        .led-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .led {
            width: 12px;
            height: 12px;
            background: 
                radial-gradient(circle at 30% 30%, #ffd700, #ffaa00);
            border-radius: 50%;
            box-shadow: 
                0 0 20px rgba(255, 215, 0, 1),
                0 0 40px rgba(255, 215, 0, 0.6),
                inset 0 -3px 6px rgba(0, 0, 0, 0.4),
                inset 0 2px 4px rgba(255, 255, 255, 0.4);
            position: relative;
            animation: led-pulse 2s ease-in-out infinite;
        }

        @keyframes led-pulse {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 1), 0 0 40px rgba(255, 215, 0, 0.6), inset 0 -3px 6px rgba(0, 0, 0, 0.4); }
            50% { box-shadow: 0 0 30px rgba(255, 215, 0, 1), 0 0 60px rgba(255, 215, 0, 0.8), inset 0 -3px 6px rgba(0, 0, 0, 0.4); }
        }

        .led::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            filter: blur(1px);
        }

        .led.off {
            background: 
                radial-gradient(circle at 30% 30%, #3a3a00, #1a1a00);
            box-shadow: 
                inset 0 2px 6px rgba(0, 0, 0, 0.9),
                0 1px 2px rgba(0, 0, 0, 0.5);
            animation: none;
        }

        .led.off::after {
            display: none;
        }

        .led-label {
            font-size: 9px;
            font-weight: 700;
            color: #ffd700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.6);
        }

        /* Spectrum visualizer - compact square */
        .spectrum-container {
            width: 100%;
            margin: 0 auto 20px;
            position: relative;
        }
        
        .visualizer {
            width: 100%;
            height: 80px;
            background: 
                linear-gradient(180deg, #0a0a15, #1e1e2e);
            border-radius: 8px;
            border: 3px solid rgba(0, 255, 204, 0.3);
            box-shadow: 
                0 8px 20px rgba(0, 0, 0, 0.6),
                inset 0 -4px 10px rgba(0, 0, 0, 0.6),
                inset 0 4px 10px rgba(255, 255, 255, 0.05),
                0 0 30px rgba(0, 255, 204, 0.2);
            display: block;
        }
        
        @media (max-width: 480px) {
            .visualizer {
                height: 70px;
                border-width: 2px;
            }
        }

        /* Control buttons below visualizer */
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
        }

        .control-btn {
            width: 55px;
            height: 55px;
            background: 
                linear-gradient(145deg, #2d2d3f, #1a1a2a);
            border-radius: 50%;
            border: 4px solid #0a0a0a;
            color: #00ffcc;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                0 6px 20px rgba(0, 0, 0, 0.4),
                inset 0 2px 6px rgba(255, 255, 255, 0.1),
                inset 0 -2px 6px rgba(0, 0, 0, 0.5);
            position: relative;
        }

        .control-btn::before {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.2), transparent);
            border-radius: 50%;
            filter: blur(3px);
        }

        .control-btn:hover {
            transform: translateY(-3px);
            box-shadow: 
                0 10px 30px rgba(0, 255, 204, 0.4),
                inset 0 2px 6px rgba(255, 255, 255, 0.2),
                inset 0 -2px 6px rgba(0, 0, 0, 0.5);
            color: #00ffcc;
            text-shadow: 0 0 10px rgba(0, 255, 204, 0.8);
        }

        .control-btn:active {
            transform: translateY(-1px);
        }

        /* Main play button - bigger and centered */
        .control-btn.play {
            width: 75px;
            height: 75px;
            background: 
                linear-gradient(145deg, #ff6ec7, #d84fa8);
            border: 5px solid #0a0a0a;
            color: #fff;
            font-size: 28px;
            box-shadow: 
                0 8px 30px rgba(255, 110, 199, 0.5),
                inset 0 3px 10px rgba(255, 255, 255, 0.2),
                inset 0 -3px 10px rgba(0, 0, 0, 0.4);
        }

        .control-btn.play::before {
            width: 30px;
            height: 30px;
            top: 5px;
            left: 5px;
        }

        .control-btn.play:hover {
            box-shadow: 
                0 12px 40px rgba(255, 110, 199, 0.7),
                0 0 60px rgba(255, 110, 199, 0.4),
                inset 0 3px 10px rgba(255, 255, 255, 0.3),
                inset 0 -3px 10px rgba(0, 0, 0, 0.4);
        }

        /* Track display section */
        .track-display {
            background: 
                linear-gradient(145deg, #0f0f1f, #050508);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 18px;
            border: 4px solid #0a0a0a;
            box-shadow: 
                inset 0 4px 15px rgba(0, 0, 0, 0.9),
                inset 0 -2px 8px rgba(120, 115, 245, 0.1),
                0 4px 20px rgba(0, 0, 0, 0.3);
            min-height: 85px;
            position: relative;
            overflow: hidden;
        }

        .track-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(0, 255, 204, 0.3) 25%, 
                rgba(255, 110, 199, 0.3) 75%, 
                transparent 100%
            );
        }

        .track-title {
            font-size: 16px;
            font-weight: 900;
            color: #00ffcc;
            margin-bottom: 10px;
            text-shadow: 
                0 0 20px rgba(0, 255, 204, 1),
                0 0 40px rgba(0, 255, 204, 0.5),
                0 2px 4px rgba(0, 0, 0, 0.8);
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .track-title:hover {
            color: #fff;
            text-shadow: 
                0 0 25px rgba(0, 255, 204, 1),
                0 0 50px rgba(0, 255, 204, 0.8),
                0 2px 4px rgba(0, 0, 0, 0.8);
            transform: translateX(3px);
        }

        .track-title a {
            color: inherit;
            text-decoration: none;
        }

        .track-artist {
            font-size: 13px;
            color: #ff6ec7;
            text-shadow: 
                0 0 15px rgba(255, 110, 199, 0.8),
                0 0 30px rgba(255, 110, 199, 0.4),
                0 2px 4px rgba(0, 0, 0, 0.6);
            font-family: 'Orbitron', sans-serif;
            font-weight: 600;
        }

        .progress-container {
            margin-top: 15px;
            background: #000;
            border-radius: 5px;
            height: 8px;
            overflow: hidden;
            border: 2px solid #1a1a1a;
            box-shadow: 
                inset 0 2px 6px rgba(0, 0, 0, 0.8),
                0 1px 2px rgba(120, 115, 245, 0.2);
            position: relative;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #ff6ec7, #7873f5, #00ffcc);
            transition: width 0.3s ease;
            box-shadow: 
                0 0 15px rgba(0, 255, 204, 0.8),
                0 0 30px rgba(255, 110, 199, 0.6);
            position: relative;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 4px;
            height: 100%;
            background: #fff;
            box-shadow: 0 0 8px #fff;
        }

        /* Input section */
        .input-section {
            margin-bottom: 18px;
        }

        .input-wrapper {
            display: flex;
            gap: 10px;
        }

        input {
            flex: 1;
            background: rgba(15, 15, 31, 0.8);
            border: 3px solid #1a1a1a;
            border-radius: 10px;
            padding: 12px 15px;
            color: #00ffcc;
            font-family: 'Orbitron', sans-serif;
            font-size: 12px;
            font-weight: 600;
            outline: none;
            box-shadow: 
                inset 0 3px 10px rgba(0, 0, 0, 0.6),
                0 2px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        
        @media (max-width: 480px) {
            input {
                padding: 10px 12px;
                font-size: 11px;
                border-width: 2px;
            }
        }

        input:focus {
            border-color: #00ffcc;
            box-shadow: 
                inset 0 3px 10px rgba(0, 0, 0, 0.6),
                0 0 20px rgba(0, 255, 204, 0.4),
                0 0 40px rgba(0, 255, 204, 0.2);
            text-shadow: 0 0 8px rgba(0, 255, 204, 0.6);
        }

        input::placeholder {
            color: rgba(0, 255, 204, 0.3);
            font-weight: 400;
        }

        .add-btn {
            background: 
                linear-gradient(145deg, #00ffcc, #00d4aa);
            border: 3px solid #0a0a0a;
            border-radius: 10px;
            padding: 12px 22px;
            color: #0a0a0a;
            font-family: 'Orbitron', sans-serif;
            font-size: 12px;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 
                0 6px 15px rgba(0, 255, 204, 0.4),
                inset 0 2px 6px rgba(255, 255, 255, 0.3),
                inset 0 -2px 6px rgba(0, 0, 0, 0.2);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .add-btn:hover {
            transform: translateY(-3px);
            box-shadow: 
                0 10px 25px rgba(0, 255, 204, 0.6),
                0 0 40px rgba(0, 255, 204, 0.3),
                inset 0 2px 6px rgba(255, 255, 255, 0.4),
                inset 0 -2px 6px rgba(0, 0, 0, 0.2);
        }

        .add-btn:active {
            transform: translateY(-1px);
        }

        .bulk-toggle-btn {
            background: rgba(120, 115, 245, 0.2);
            border: 2px solid rgba(120, 115, 245, 0.4);
            border-radius: 8px;
            padding: 8px 16px;
            color: #7873f5;
            font-family: 'Orbitron', sans-serif;
            font-size: 11px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .bulk-toggle-btn:hover {
            background: rgba(120, 115, 245, 0.3);
            border-color: rgba(120, 115, 245, 0.6);
            box-shadow: 0 0 15px rgba(120, 115, 245, 0.3);
        }

        .bulk-input-wrapper {
            margin-top: 15px;
        }

        textarea {
            width: 100%;
            background: rgba(15, 15, 31, 0.8);
            border: 3px solid #1a1a1a;
            border-radius: 10px;
            padding: 12px 15px;
            color: #00ffcc;
            font-family: 'Orbitron', sans-serif;
            font-size: 11px;
            font-weight: 600;
            outline: none;
            box-shadow: 
                inset 0 3px 10px rgba(0, 0, 0, 0.6),
                0 2px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            resize: vertical;
            margin-bottom: 10px;
        }

        textarea:focus {
            border-color: #7873f5;
            box-shadow: 
                inset 0 3px 10px rgba(0, 0, 0, 0.6),
                0 0 20px rgba(120, 115, 245, 0.4),
                0 0 40px rgba(120, 115, 245, 0.2);
            text-shadow: 0 0 8px rgba(120, 115, 245, 0.6);
        }

        textarea::placeholder {
            color: rgba(120, 115, 245, 0.3);
            font-weight: 400;
        }

        .bulk-add-btn {
            width: 100%;
            background: 
                linear-gradient(145deg, #7873f5, #5a55d0);
            border: 3px solid #0a0a0a;
            border-radius: 10px;
            padding: 12px 22px;
            color: #fff;
            font-family: 'Orbitron', sans-serif;
            font-size: 12px;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 
                0 6px 15px rgba(120, 115, 245, 0.4),
                inset 0 2px 6px rgba(255, 255, 255, 0.3),
                inset 0 -2px 6px rgba(0, 0, 0, 0.2);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .bulk-add-btn:hover {
            transform: translateY(-3px);
            box-shadow: 
                0 10px 25px rgba(120, 115, 245, 0.6),
                0 0 40px rgba(120, 115, 245, 0.3),
                inset 0 2px 6px rgba(255, 255, 255, 0.4),
                inset 0 -2px 6px rgba(0, 0, 0, 0.2);
        }

        .bulk-add-btn:active {
            transform: translateY(-1px);
        }

        /* Featured Playlists */
        .featured-section {
            margin-bottom: 18px;
        }

        .featured-toggle-btn {
            width: 100%;
            background: linear-gradient(145deg, rgba(255, 215, 0, 0.2), rgba(255, 215, 0, 0.1));
            border: 3px solid rgba(255, 215, 0, 0.4);
            border-radius: 12px;
            padding: 12px 20px;
            color: #ffd700;
            font-family: 'Orbitron', sans-serif;
            font-size: 13px;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.2);
        }

        .featured-toggle-btn:hover {
            background: linear-gradient(145deg, rgba(255, 215, 0, 0.3), rgba(255, 215, 0, 0.2));
            border-color: rgba(255, 215, 0, 0.6);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
            transform: translateY(-2px);
        }

        .featured-playlists {
            margin-top: 12px;
            background: rgba(15, 15, 31, 0.6);
            border-radius: 12px;
            border: 2px solid rgba(255, 215, 0, 0.2);
            padding: 12px;
            max-height: 300px;
            overflow-y: auto;
        }

        .featured-playlist-item {
            background: rgba(26, 26, 46, 0.6);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 4px solid #ffd700;
            transition: all 0.3s ease;
        }

        .featured-playlist-item:hover {
            background: rgba(255, 215, 0, 0.1);
            border-left-color: #00ffcc;
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.2);
        }

        .featured-playlist-name {
            color: #ffd700;
            font-size: 13px;
            font-weight: 900;
            margin-bottom: 4px;
            font-family: 'Orbitron', sans-serif;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.6);
        }

        .featured-playlist-curator {
            color: #ff6ec7;
            font-size: 10px;
            margin-bottom: 6px;
            font-family: 'Orbitron', sans-serif;
            opacity: 0.8;
        }

        .featured-playlist-count {
            color: #00ffcc;
            font-size: 10px;
            margin-bottom: 8px;
            font-family: 'Orbitron', sans-serif;
        }

        .copy-playlist-btn {
            background: linear-gradient(145deg, #00ffcc, #00d4aa);
            border: 2px solid #0a0a0a;
            border-radius: 8px;
            padding: 8px 16px;
            color: #0a0a0a;
            font-family: 'Orbitron', sans-serif;
            font-size: 10px;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .copy-playlist-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 255, 204, 0.4);
        }

        /* Playlist Header */
        .playlist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .playlist-title {
            color: #00ffcc;
            font-size: 12px;
            font-weight: 900;
            font-family: 'Orbitron', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 10px rgba(0, 255, 204, 0.6);
        }

        .clear-all-btn {
            background: rgba(255, 0, 80, 0.2);
            border: 2px solid rgba(255, 0, 80, 0.4);
            border-radius: 8px;
            padding: 6px 12px;
            color: #ff0050;
            font-family: 'Orbitron', sans-serif;
            font-size: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .clear-all-btn:hover {
            background: rgba(255, 0, 80, 0.3);
            border-color: rgba(255, 0, 80, 0.6);
            box-shadow: 0 0 15px rgba(255, 0, 80, 0.3);
            transform: translateY(-2px);
        }

        .submit-playlist-btn {
            background: linear-gradient(145deg, rgba(120, 115, 245, 0.3), rgba(120, 115, 245, 0.2));
            border: 3px solid rgba(120, 115, 245, 0.4);
            border-radius: 10px;
            padding: 10px 20px;
            color: #7873f5;
            font-family: 'Orbitron', sans-serif;
            font-size: 11px;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 12px rgba(120, 115, 245, 0.2);
        }

        .submit-playlist-btn:hover {
            background: linear-gradient(145deg, rgba(120, 115, 245, 0.4), rgba(120, 115, 245, 0.3));
            border-color: rgba(120, 115, 245, 0.6);
            box-shadow: 0 6px 18px rgba(120, 115, 245, 0.4);
            transform: translateY(-2px);
        }

        /* Random Discovery Button */
        .random-discovery-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(145deg, rgba(255, 110, 199, 0.3), rgba(255, 110, 199, 0.2));
            border: 2px solid rgba(255, 110, 199, 0.5);
            border-radius: 10px;
            color: #ff6ec7;
            font-family: 'Orbitron', sans-serif;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .random-discovery-btn:hover {
            background: linear-gradient(145deg, rgba(255, 110, 199, 0.4), rgba(255, 110, 199, 0.3));
            border-color: rgba(255, 110, 199, 0.6);
            box-shadow: 0 6px 18px rgba(255, 110, 199, 0.4);
            transform: translateY(-2px);
        }

        .random-discovery-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }


        /* Info Button & Modal */
        .info-btn {
            position: absolute;
            top: 70px;
            right: 30px;
            width: 32px;
            height: 32px;
            background: linear-gradient(145deg, rgba(0, 255, 204, 0.2), rgba(0, 255, 204, 0.1));
            border: 2px solid rgba(0, 255, 204, 0.4);
            border-radius: 50%;
            color: #00ffcc;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 100;
        }

        .info-btn:hover {
            background: linear-gradient(145deg, rgba(0, 255, 204, 0.3), rgba(0, 255, 204, 0.2));
            border-color: rgba(0, 255, 204, 0.6);
            box-shadow: 0 0 20px rgba(0, 255, 204, 0.4);
            transform: scale(1.1);
        }

        .info-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }

        .info-modal.show {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .info-content {
            background: linear-gradient(145deg, #1a1a2e, #0f0f1f);
            border: 3px solid #00ffcc;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 255, 204, 0.3);
            position: relative;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(50px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        .info-close {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 30px;
            height: 30px;
            background: rgba(255, 0, 80, 0.2);
            border: 2px solid rgba(255, 0, 80, 0.4);
            border-radius: 50%;
            color: #ff0050;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .info-close:hover {
            background: rgba(255, 0, 80, 0.4);
            border-color: rgba(255, 0, 80, 0.6);
            transform: rotate(90deg);
        }

        .info-title {
            color: #ffd700;
            font-size: 24px;
            font-weight: 900;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
        }

        .info-section {
            margin-bottom: 20px;
        }

        .info-section-title {
            color: #ff6ec7;
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .info-text {
            color: #00ffcc;
            font-size: 13px;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .info-list {
            list-style: none;
            padding-left: 0;
        }

        .info-list li {
            color: #00ffcc;
            font-size: 12px;
            line-height: 1.8;
            padding-left: 20px;
            position: relative;
        }

        .info-list li::before {
            content: "‚Üí";
            position: absolute;
            left: 0;
            color: #ff6ec7;
        }

        @media (max-width: 480px) {
            .info-btn {
                top: 60px;
                right: 20px;
                width: 28px;
                height: 28px;
                font-size: 16px;
            }

            .info-content {
                padding: 25px 20px;
            }

            .info-title {
                font-size: 20px;
            }
        }


        /* Playlist */
        .playlist {
            background: rgba(15, 15, 31, 0.6);
            border-radius: 15px;
            border: 3px solid #1a1a1a;
            padding: 12px;
            max-height: 150px;
            overflow-y: auto;
            box-shadow: 
                inset 0 3px 10px rgba(0, 0, 0, 0.7),
                0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        @media (max-width: 480px) {
            .playlist {
                max-height: 120px;
                padding: 10px;
                border-radius: 12px;
                border-width: 2px;
            }
        }

        .playlist::-webkit-scrollbar {
            width: 10px;
        }

        .playlist::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 5px;
            margin: 5px;
        }

        .playlist::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #00ffcc, #7873f5);
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 255, 204, 0.5);
        }

        .playlist::-webkit-scrollbar-thumb:hover {
            box-shadow: 0 0 15px rgba(0, 255, 204, 0.8);
        }

        .playlist-item {
            padding: 10px 12px;
            margin-bottom: 8px;
            background: rgba(26, 26, 46, 0.4);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .playlist-item:hover {
            background: rgba(0, 255, 204, 0.15);
            border-left-color: #00ffcc;
            box-shadow: 
                0 4px 12px rgba(0, 255, 204, 0.3),
                inset 0 0 20px rgba(0, 255, 204, 0.1);
        }

        .playlist-item.active {
            background: rgba(255, 110, 199, 0.15);
            border-left-color: #ff6ec7;
            box-shadow: 
                0 4px 12px rgba(255, 110, 199, 0.4),
                inset 0 0 20px rgba(255, 110, 199, 0.1);
        }

        .playlist-item-title {
            color: #00ffcc;
            font-size: 12px;
            font-weight: 700;
            margin-bottom: 4px;
            font-family: 'Orbitron', sans-serif;
            text-shadow: 0 0 10px rgba(0, 255, 204, 0.6);
            padding-right: 25px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .playlist-item-title:hover {
            color: #fff;
            text-shadow: 0 0 15px rgba(0, 255, 204, 0.9);
        }

        .playlist-item-title a {
            color: inherit;
            text-decoration: none;
        }

        .playlist-item-artist {
            color: #ff6ec7;
            font-size: 11px;
            font-weight: 600;
            font-family: 'Orbitron', sans-serif;
            text-shadow: 0 0 8px rgba(255, 110, 199, 0.5);
        }

        .delete-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 20px;
            height: 20px;
            background: rgba(255, 0, 80, 0.8);
            color: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            opacity: 0;
            transition: all 0.2s ease;
            line-height: 1;
            font-family: Arial, sans-serif;
        }

        .playlist-item:hover .delete-btn {
            opacity: 1;
        }

        .delete-btn:hover {
            background: rgba(255, 0, 80, 1);
            transform: scale(1.1);
        }

        .loading {
            display: none;
            text-align: center;
            color: #00ffcc;
            font-size: 12px;
            padding: 10px;
            font-weight: 900;
            font-family: 'Orbitron', sans-serif;
            text-shadow: 0 0 15px rgba(0, 255, 204, 0.8);
        }

        .loading.active {
            display: block;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .loading.active {
            animation: pulse 1.5s ease-in-out infinite;
        }

        .status {
            text-align: center;
            color: #ffd700;
            font-size: 11px;
            margin-top: 15px;
            font-weight: 700;
            opacity: 0.6;
            font-family: 'Orbitron', sans-serif;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.4);
        }

        /* Update notification banner */
        .update-banner {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(145deg, rgba(0, 255, 204, 0.95), rgba(0, 212, 170, 0.95));
            border: 3px solid #00ffcc;
            border-radius: 15px;
            padding: 15px 20px;
            display: none;
            align-items: center;
            gap: 15px;
            box-shadow: 
                0 10px 40px rgba(0, 255, 204, 0.5),
                0 0 60px rgba(0, 255, 204, 0.3);
            z-index: 9999;
            max-width: 90%;
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateX(-50%) translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        .update-banner.show {
            display: flex;
        }

        .update-text {
            color: #0a0a0a;
            font-family: 'Orbitron', sans-serif;
            font-size: 12px;
            font-weight: 700;
            flex: 1;
        }

        .update-btn {
            background: linear-gradient(145deg, #ffd700, #ffaa00);
            border: 2px solid #0a0a0a;
            border-radius: 8px;
            padding: 8px 16px;
            color: #0a0a0a;
            font-family: 'Orbitron', sans-serif;
            font-size: 11px;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            white-space: nowrap;
        }

        .update-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.6);
        }

        .update-dismiss {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(0, 0, 0, 0.5);
            color: #0a0a0a;
        }

        .update-dismiss:hover {
            background: rgba(0, 0, 0, 0.5);
            box-shadow: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="walkman">
            <!-- Glow layer -->
            <div class="walkman-glow"></div>
            
            <!-- Logo -->
            <div class="logo">TEZOS</div>

            <!-- Info Button -->
            <div class="info-btn" onclick="toggleInfo()">‚Ñπ</div>

            <!-- Status LEDs -->
            <div class="status-leds">
                <div class="led-row">
                    <div class="led" id="led1"></div>
                    <div class="led-label">ON/PLAY</div>
                </div>
                <div class="led-row">
                    <div class="led off" id="led2"></div>
                    <div class="led-label">FM STEREO</div>
                </div>
            </div>

            <!-- Spectrum Visualizer -->
            <div class="spectrum-container">
                <canvas class="visualizer" id="visualizer"></canvas>
            </div>

            <!-- Controls below visualizer -->
            <div class="controls">
                <button class="control-btn" onclick="previousTrack()" title="Previous">‚èÆ</button>
                <button class="control-btn play" onclick="togglePlay()" id="playBtn" title="Play/Pause">‚ñ∂</button>
                <button class="control-btn" onclick="nextTrack()" title="Next">‚è≠</button>
            </div>

            <!-- Track display -->
            <div class="track-display">
                <div class="track-title" id="trackTitle">Ready to play</div>
                <div class="track-artist" id="trackArtist">Add Objkt NFT link to begin</div>
                <div class="progress-container">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
            </div>

            <!-- Input section -->
            <div class="input-section">
                <div class="input-wrapper">
                    <input 
                        type="text" 
                        id="nftInput" 
                        placeholder="Paste Objkt.com NFT link..."
                    >
                    <button class="add-btn" onclick="addTrack()">ADD</button>
                </div>
                <div style="text-align: center; margin: 10px 0;">
                    <button class="bulk-toggle-btn" onclick="toggleBulkMode()" id="bulkToggleBtn">üìã Bulk Add</button>
                </div>
                <div class="bulk-input-wrapper" id="bulkInputWrapper" style="display: none;">
                    <textarea 
                        id="bulkInput" 
                        placeholder="Paste multiple Objkt links (one per line)&#10;&#10;Example:&#10;https://objkt.com/tokens/...&#10;https://objkt.com/tokens/...&#10;https://objkt.com/tokens/..."
                        rows="6"
                    ></textarea>
                    <button class="bulk-add-btn" onclick="bulkAddTracks()">ADD ALL</button>
                </div>
            </div>

            <div class="loading" id="loading">LOADING TRACK DATA...</div>

            <!-- Random Discovery Button -->
            <button class="random-discovery-btn" onclick="discoverRandomMusic()" id="randomDiscoveryBtn">
                üé≤ Discover Random Music
            </button>

            <!-- Featured Playlists Section -->
            <div class="featured-section">
                <button class="featured-toggle-btn" onclick="toggleFeatured()" id="featuredToggleBtn">
                    ‚≠ê Featured Playlists
                </button>
                <div class="featured-playlists" id="featuredPlaylists" style="display: none;">
                    <!-- Playlists will be loaded here -->
                </div>
            </div>

            <!-- Playlist -->
            <div class="playlist-header">
                <span class="playlist-title">My Playlist</span>
                <button class="clear-all-btn" onclick="clearAllTracks()" title="Clear all tracks">üóëÔ∏è Clear All</button>
            </div>
            <div class="playlist" id="playlist"></div>

            <div class="status" id="status">Playlist empty</div>
            
            <!-- Submit Playlist Button -->
            <div style="text-align: center; margin-top: 15px;">
                <button class="submit-playlist-btn" onclick="openSubmitForm()">üìù Submit Your Playlist</button>
            </div>
        </div>
    </div>

    <!-- Info Modal -->
    <div class="info-modal" id="infoModal" onclick="closeInfoModal(event)">
        <div class="info-content" onclick="event.stopPropagation()">
            <div class="info-close" onclick="toggleInfo()">√ó</div>
            <div class="info-title">üéµ Welcome to TEZ FM</div>
            
            <div class="info-section">
                <div class="info-section-title">What is this?</div>
                <div class="info-text">TEZ FM is a vaporwave radio player for discovering and streaming Tezos music NFTs. Built by the community, for the community.</div>
            </div>
            
            <div class="info-section">
                <div class="info-section-title">How to use:</div>
                <ul class="info-list">
                    <li>Paste Objkt.com music NFT links to build your playlist</li>
                    <li>Use Bulk Add for multiple tracks at once</li>
                    <li>Browse Featured Playlists curated by the community</li>
                    <li>Submit your own playlist to be featured</li>
                </ul>
            </div>
            
            <div class="info-section">
                <div class="info-section-title">Install as App:</div>
                <ul class="info-list">
                    <li>iOS: Tap share ‚Üí Add to Home Screen</li>
                    <li>Android: Tap menu ‚Üí Install app</li>
                    <li>Desktop: Click install icon in address bar</li>
                </ul>
            </div>
            
            <div class="info-section">
                <div class="info-text" style="text-align: center; font-size: 11px; opacity: 0.7; margin-top: 15px;">
                    Built with ‚ô• for the Tezos music community
                </div>
            </div>
        </div>
    </div>

    <!-- Update notification banner -->
    <div class="update-banner" id="updateBanner">
        <div class="update-text">üéµ New playlists available!</div>
        <button class="update-btn" onclick="refreshApp()">Refresh Now</button>
        <button class="update-btn update-dismiss" onclick="dismissUpdate()">Later</button>
    </div>

    <audio id="audioPlayer" preload="auto" crossorigin="anonymous" style="display: none;"></audio>

    <script>
        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('ServiceWorker registered:', registration.scope);
                        
                        // Check for updates every 5 minutes
                        setInterval(() => {
                            registration.update();
                        }, 5 * 60 * 1000);
                        
                        // Listen for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // New service worker available
                                    showUpdateNotification();
                                }
                            });
                        });
                    })
                    .catch((error) => {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }

        // Update notification functions
        function showUpdateNotification() {
            const banner = document.getElementById('updateBanner');
            banner.classList.add('show');
        }

        function refreshApp() {
            window.location.reload();
        }

        function dismissUpdate() {
            const banner = document.getElementById('updateBanner');
            banner.classList.remove('show');
        }

        // Info modal functions
        function toggleInfo() {
            const modal = document.getElementById('infoModal');
            modal.classList.toggle('show');
        }

        function closeInfoModal(event) {
            if (event.target.id === 'infoModal') {
                toggleInfo();
            }
        }

        let playlist = [];
        let currentTrackIndex = -1;
        let isPlaying = false;
        const audioPlayer = document.getElementById('audioPlayer');
        let activePlayer = audioPlayer;
        const playBtn = document.getElementById('playBtn');
        const progressBar = document.getElementById('progressBar');

        // Media Session API - Enable lock screen controls and background playback
        function updateMediaSession() {
            if ('mediaSession' in navigator && currentTrackIndex >= 0 && currentTrackIndex < playlist.length) {
                const track = playlist[currentTrackIndex];
                
                navigator.mediaSession.metadata = new MediaMetadata({
                    title: track.title,
                    artist: track.artist,
                    album: 'Tezos NFT Collection',
                    artwork: [
                        { src: 'icon-96.png', sizes: '96x96', type: 'image/png' },
                        { src: 'icon-128.png', sizes: '128x128', type: 'image/png' },
                        { src: 'icon-192.png', sizes: '192x192', type: 'image/png' },
                        { src: 'icon-256.png', sizes: '256x256', type: 'image/png' },
                        { src: 'icon-384.png', sizes: '384x384', type: 'image/png' },
                        { src: 'icon-512.png', sizes: '512x512', type: 'image/png' }
                    ]
                });

                // Set up action handlers for lock screen controls
                navigator.mediaSession.setActionHandler('play', () => {
                    play();
                });
                
                navigator.mediaSession.setActionHandler('pause', () => {
                    pause();
                });
                
                navigator.mediaSession.setActionHandler('previoustrack', () => {
                    previousTrack();
                });
                
                navigator.mediaSession.setActionHandler('nexttrack', () => {
                    nextTrack();
                });
                
                navigator.mediaSession.setActionHandler('seekbackward', (details) => {
                    const skipTime = details.seekOffset || 10;
                    activePlayer.currentTime = Math.max(activePlayer.currentTime - skipTime, 0);
                });
                
                navigator.mediaSession.setActionHandler('seekforward', (details) => {
                    const skipTime = details.seekOffset || 10;
                    activePlayer.currentTime = Math.min(activePlayer.currentTime + skipTime, activePlayer.duration);
                });
                
                // Update position state for lock screen scrubber
                if ('setPositionState' in navigator.mediaSession) {
                    navigator.mediaSession.setPositionState({
                        duration: activePlayer.duration || 0,
                        playbackRate: activePlayer.playbackRate,
                        position: activePlayer.currentTime || 0
                    });
                }
            }
        }

        // LocalStorage key
        const STORAGE_KEY = 'tezos_walkman_playlist';

        // Load playlist from localStorage on page load
        function loadPlaylistFromStorage() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    const data = JSON.parse(saved);
                    playlist = data.playlist || [];
                    currentTrackIndex = data.currentTrackIndex || -1;
                    
                    if (playlist.length > 0) {
                        updatePlaylist();
                        if (currentTrackIndex >= 0 && currentTrackIndex < playlist.length) {
                            loadTrack(currentTrackIndex);
                        }
                        updateStatus();
                    }
                }
            } catch (error) {
                console.error('Error loading playlist from storage:', error);
            }
        }

        // Save playlist to localStorage
        function savePlaylistToStorage() {
            try {
                const data = {
                    playlist: playlist,
                    currentTrackIndex: currentTrackIndex
                };
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            } catch (error) {
                console.error('Error saving playlist to storage:', error);
            }
        }

        // Audio visualizer setup
        const canvas = document.getElementById('visualizer');
        const ctx = canvas.getContext('2d');
        let audioContext;
        let analyser;
        let dataArray;
        let bufferLength;
        let animationId;

        // Set canvas size
        function resizeCanvas() {
            const pod = document.querySelector('.control-pod');
            canvas.width = pod.offsetWidth;
            canvas.height = pod.offsetHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Initialize audio context and analyser
        function initAudioContext() {
            if (!audioContext) {
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    analyser = audioContext.createAnalyser();
                    analyser.fftSize = 128;
                    bufferLength = analyser.frequencyBinCount;
                    dataArray = new Uint8Array(bufferLength);
                    
                    // Only create source once - will connect to whichever player is active
                    const source = audioContext.createMediaElementSource(activePlayer);
                    source.connect(analyser);
                    analyser.connect(audioContext.destination);
                    
                    console.log('Audio context initialized successfully');
                } catch (error) {
                    console.error('Error initializing audio context:', error);
                }
            }
        }

        // Retrowave visualizer animation - BADASS VERSION
        let lastPulseTime = 0;
        const pulseThreshold = 100; // Minimum ms between pulses
        
        function drawVisualizer() {
            animationId = requestAnimationFrame(drawVisualizer);
            
            if (!analyser) return;
            
            analyser.getByteFrequencyData(dataArray);
            
            const width = canvas.width;
            const height = canvas.height;
            const centerX = width / 2;
            const centerY = height / 2;
            
            // Calculate audio intensity for body pulse
            const avgValue = dataArray.reduce((a, b) => a + b, 0) / bufferLength;
            const maxValue = Math.max(...dataArray);
            
            // Make the entire player body pulse with audio
            const walkmanEl = document.querySelector('.walkman');
            const walkmanGlow = document.querySelector('.walkman-glow');
            const now = Date.now();
            
            // Continuously update grid based on audio - ALWAYS REACTIVE
            const bassIntensity = Math.max(...dataArray.slice(0, 8)) / 255; // Low frequencies
            const midIntensity = Math.max(...dataArray.slice(8, 32)) / 255; // Mid frequencies
            const highIntensity = Math.max(...dataArray.slice(32, 64)) / 255; // High frequencies
            
            // Grid gets MUCH brighter and scales dramatically with bass
            const gridOpacity = 0.4 + (bassIntensity * 0.6); // 0.4 to 1.0
            const gridScale = 2 + (bassIntensity * 0.8); // 2.0 to 2.8
            const backgroundGlowIntensity = 0.12 + (avgValue / 255) * 0.3; // 0.12 to 0.42
            
            // Update CSS variables for smooth transitions
            walkmanEl.style.setProperty('--grid-opacity', gridOpacity);
            walkmanEl.style.setProperty('--grid-scale', gridScale);
            if (walkmanGlow) {
                walkmanGlow.style.setProperty('--glow-intensity', backgroundGlowIntensity);
            }
            
            // Speed up grid animation on bass hits
            if (bassIntensity > 0.6) {
                walkmanEl.style.setProperty('--grid-speed', '4s');
            } else {
                walkmanEl.style.setProperty('--grid-speed', '8s');
            }
            
            if (maxValue > 180 && (now - lastPulseTime) > pulseThreshold) {
                walkmanEl.classList.add('audio-react');
                
                // Dynamic border glow based on audio intensity
                const intensity = maxValue / 255;
                walkmanEl.style.borderColor = `rgba(255, 215, 0, ${0.3 + intensity * 0.7})`;
                walkmanEl.style.boxShadow = `
                    0 30px 80px rgba(0, 0, 0, 0.8),
                    0 15px 40px rgba(255, 215, 0, ${0.2 + intensity * 0.6}),
                    0 0 ${40 + intensity * 60}px rgba(255, 215, 0, ${intensity * 0.8}),
                    0 0 ${80 + intensity * 120}px rgba(255, 110, 199, ${intensity * 0.4}),
                    inset 0 -8px 25px rgba(0, 0, 0, 0.6),
                    inset 0 8px 25px rgba(255, 215, 0, ${0.1 + intensity * 0.3}),
                    inset 2px 0 15px rgba(255, 215, 0, ${0.15 + intensity * 0.2}),
                    inset -2px 0 15px rgba(255, 110, 199, ${0.1 + intensity * 0.2})
                `;
                
                setTimeout(() => {
                    walkmanEl.classList.remove('audio-react');
                }, 100);
                
                lastPulseTime = now;
            } else if (maxValue < 100) {
                // Reset to normal when quiet
                walkmanEl.style.borderColor = 'rgba(255, 215, 0, 0.3)';
                walkmanEl.style.boxShadow = `
                    0 30px 80px rgba(0, 0, 0, 0.8),
                    0 15px 40px rgba(255, 215, 0, 0.2),
                    inset 0 -8px 25px rgba(0, 0, 0, 0.6),
                    inset 0 8px 25px rgba(255, 215, 0, 0.1),
                    inset 2px 0 15px rgba(255, 215, 0, 0.15),
                    inset -2px 0 15px rgba(255, 110, 199, 0.1)
                `;
            }
            
            // Clear canvas
            ctx.fillStyle = 'rgba(10, 10, 21, 0.3)';
            ctx.fillRect(0, 0, width, height);
            
            // Draw chromatic spectrum bars
            const bars = 64;
            const barWidth = width / bars;
            const barSpacing = 1;
            
            for (let i = 0; i < bars; i++) {
                const dataIndex = Math.floor((i / bars) * bufferLength);
                const value = dataArray[dataIndex] || 0;
                const barHeight = (value / 255) * height * 0.9;
                
                // Calculate x position
                const x = i * barWidth;
                const y = height - barHeight;
                
                // Create chromatic gradient based on position (frequency)
                const gradient = ctx.createLinearGradient(x, height, x, y);
                
                // Color mapping: Bass (yellow) ‚Üí Mids (pink/purple) ‚Üí Highs (cyan)
                if (i < bars / 4) {
                    // Bass - Yellow to Gold
                    gradient.addColorStop(0, `rgba(255, 215, 0, ${0.8 + value/255 * 0.2})`);
                    gradient.addColorStop(1, `rgba(255, 255, 100, ${0.6 + value/255 * 0.4})`);
                } else if (i < bars / 2) {
                    // Low-mids - Orange to Pink
                    gradient.addColorStop(0, `rgba(255, 140, 0, ${0.8 + value/255 * 0.2})`);
                    gradient.addColorStop(1, `rgba(255, 110, 199, ${0.6 + value/255 * 0.4})`);
                } else if (i < (bars * 3) / 4) {
                    // High-mids - Pink to Purple
                    gradient.addColorStop(0, `rgba(255, 110, 199, ${0.8 + value/255 * 0.2})`);
                    gradient.addColorStop(1, `rgba(120, 115, 245, ${0.6 + value/255 * 0.4})`);
                } else {
                    // Highs - Purple to Cyan
                    gradient.addColorStop(0, `rgba(120, 115, 245, ${0.8 + value/255 * 0.2})`);
                    gradient.addColorStop(1, `rgba(0, 255, 204, ${0.6 + value/255 * 0.4})`);
                }
                
                // Draw bar
                ctx.fillStyle = gradient;
                ctx.fillRect(x, y, barWidth - barSpacing, barHeight);
                
                // Add glow on high values
                if (value > 180) {
                    ctx.shadowBlur = 10 + (value / 255) * 10;
                    ctx.shadowColor = gradient;
                    ctx.fillRect(x, y, barWidth - barSpacing, barHeight);
                    ctx.shadowBlur = 0;
                }
                
                // Add peak dots for very high values
                if (value > 220) {
                    ctx.beginPath();
                    ctx.arc(x + barWidth/2, y - 3, 2, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(255, 255, 255, ${(value - 220) / 35})`;
                    ctx.fill();
                }
            }
        }

        // Start visualizer
        function startVisualizer() {
            if (!animationId) {
                drawVisualizer();
            }
        }

        // Stop visualizer
        function stopVisualizer() {
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
        }

        // Extract token ID and contract from Objkt URL
        function extractTokenId(url) {
            // Remove trailing slashes and query params
            url = url.split('?')[0].replace(/\/$/, '');
            
            const patterns = [
                // New Objkt format: objkt.com/asset/CONTRACT/TOKEN
                {
                    regex: /objkt\.com\/asset\/([^\/]+)\/(\d+)/,
                    handler: (match) => ({ contract: match[1], tokenId: match[2] })
                },
                // Tokens format: objkt.com/tokens/CONTRACT/TOKEN
                {
                    regex: /objkt\.com\/tokens\/([^\/]+)\/(\d+)/,
                    handler: (match) => {
                        // Check if it's "hicetnunc" keyword or actual contract
                        if (match[1] === 'hicetnunc') {
                            return { 
                                contract: 'KT1RJ6PbjHpwc3M5rw5s2Nbmefwbuwbdxton', 
                                tokenId: match[2] 
                            };
                        } else {
                            return { contract: match[1], tokenId: match[2] };
                        }
                    }
                },
                // Just a number at the end
                {
                    regex: /\/(\d+)$/,
                    handler: (match) => ({ 
                        contract: 'KT1RJ6PbjHpwc3M5rw5s2Nbmefwbuwbdxton', // assume hic et nunc
                        tokenId: match[1] 
                    })
                }
            ];
            
            for (let pattern of patterns) {
                const match = url.match(pattern.regex);
                if (match) {
                    return pattern.handler(match);
                }
            }
            return null;
        }

        // Fetch NFT metadata from Objkt API
        async function fetchNFTData(url) {
            const tokenInfo = extractTokenId(url);
            if (!tokenInfo) {
                throw new Error('Invalid Objkt URL - please use format: objkt.com/tokens/hicetnunc/TOKEN_ID or objkt.com/asset/CONTRACT/TOKEN_ID');
            }

            console.log('Fetching token:', tokenInfo);

            // Query for the token using correct v3 API schema
            const query = `
                query getToken {
                    token(where: {
                        fa_contract: {_eq: "${tokenInfo.contract}"},
                        token_id: {_eq: "${tokenInfo.tokenId}"}
                    }) {
                        pk
                        token_id
                        name
                        artifact_uri
                        display_uri
                        mime
                        description
                        fa_contract
                        creators {
                            creator_address
                            holder {
                                alias
                                address
                            }
                        }
                    }
                }
            `;

            try {
                const response = await fetch('https://data.objkt.com/v3/graphql', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ query })
                });

                if (!response.ok) {
                    throw new Error(`API request failed with status ${response.status}`);
                }

                const data = await response.json();
                
                console.log('API response:', data);
                
                if (data.errors) {
                    console.error('GraphQL errors:', data.errors);
                    throw new Error('GraphQL query failed: ' + JSON.stringify(data.errors));
                }
                
                if (!data.data || !data.data.token || data.data.token.length === 0) {
                    throw new Error(`NFT not found. Contract: ${tokenInfo.contract}, Token ID: ${tokenInfo.tokenId}`);
                }

                const token = data.data.token[0];
                
                console.log('Token data:', token);
                
                // Check if it's an audio OR video file using the mime field
                const isAudio = token.mime && token.mime.includes('audio');
                const isVideo = token.mime && (token.mime.includes('video') || token.mime.includes('mp4') || token.mime.includes('webm'));
                
                if (!isAudio && !isVideo) {
                    throw new Error(`This NFT is not an audio or video file (mime type: ${token.mime || 'unknown'}). Only audio/video NFTs are supported.`);
                }

                // Handle IPFS URLs
                let audioUrl = token.artifact_uri;
                if (!audioUrl) {
                    throw new Error('No artifact URI found for this NFT');
                }
                
                if (audioUrl.startsWith('ipfs://')) {
                    audioUrl = audioUrl.replace('ipfs://', 'https://ipfs.io/ipfs/');
                } else if (audioUrl.startsWith('Qm')) {
                    audioUrl = 'https://ipfs.io/ipfs/' + audioUrl;
                }

                // Get artist name from creators
                const artistName = token.creators && token.creators[0] 
                    ? (token.creators[0].holder?.alias || token.creators[0].holder?.address?.slice(0, 8) + '...' || token.creators[0].creator_address?.slice(0, 8) + '...')
                    : 'Unknown Artist';

                return {
                    title: token.name || 'Untitled',
                    artist: artistName,
                    url: audioUrl,
                    tokenId: token.token_id,
                    contract: token.fa_contract,
                    mime: token.mime
                };
            } catch (error) {
                console.error('Fetch error:', error);
                throw error;
            }
        }

        async function addTrack() {
            const input = document.getElementById('nftInput');
            const url = input.value.trim();
            
            if (!url) {
                alert('Please enter a valid Objkt URL');
                return;
            }

            const loading = document.getElementById('loading');
            loading.classList.add('active');

            try {
                const trackData = await fetchNFTData(url);
                playlist.push(trackData);
                updatePlaylist();
                input.value = '';
                
                if (currentTrackIndex === -1) {
                    currentTrackIndex = 0;
                    loadTrack(0);
                }
                
                updateStatus();
                savePlaylistToStorage(); // Save to localStorage
            } catch (error) {
                alert('Error loading track: ' + error.message);
                console.error(error);
            } finally {
                loading.classList.remove('active');
            }
        }

        function toggleBulkMode() {
            const bulkWrapper = document.getElementById('bulkInputWrapper');
            const toggleBtn = document.getElementById('bulkToggleBtn');
            
            if (bulkWrapper.style.display === 'none') {
                bulkWrapper.style.display = 'block';
                toggleBtn.textContent = '‚ûñ Hide Bulk Add';
            } else {
                bulkWrapper.style.display = 'none';
                toggleBtn.textContent = 'üìã Bulk Add';
            }
        }

        async function bulkAddTracks() {
            const textarea = document.getElementById('bulkInput');
            const rawText = textarea.value;
            
            // NUCLEAR OPTION: Use regex to extract ALL URLs, ignore all formatting
            const urlRegex = /https?:\/\/[^\s]+/g;
            const urls = rawText.match(urlRegex) || [];
            
            // Filter to only Objkt URLs
            const objktUrls = urls.filter(url => url.includes('objkt.com'));
            
            if (objktUrls.length === 0) {
                alert('Please paste at least one Objkt URL');
                return;
            }

            const loading = document.getElementById('loading');
            loading.classList.add('active');
            
            let successCount = 0;
            let failCount = 0;
            const errors = [];

            for (let i = 0; i < objktUrls.length; i++) {
                const url = objktUrls[i];
                loading.textContent = `LOADING ${i + 1}/${objktUrls.length}...`;
                
                try {
                    const trackData = await fetchNFTData(url);
                    playlist.push(trackData);
                    successCount++;
                } catch (error) {
                    failCount++;
                    errors.push(`Line ${i + 1}: ${error.message}`);
                    console.error(`Failed to load ${url}:`, error);
                }
                
                // Small delay to avoid rate limiting
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            loading.classList.remove('active');
            loading.textContent = 'LOADING TRACK DATA...';
            
            updatePlaylist();
            
            if (currentTrackIndex === -1 && playlist.length > 0) {
                currentTrackIndex = 0;
                loadTrack(0);
            }
            
            updateStatus();
            savePlaylistToStorage();
            
            // Clear textarea on success
            if (successCount > 0) {
                textarea.value = '';
            }
            
            // Show results
            let message = `‚úÖ Added ${successCount} track${successCount !== 1 ? 's' : ''}`;
            if (failCount > 0) {
                message += `\n‚ùå Failed: ${failCount}`;
                if (errors.length <= 3) {
                    message += '\n\n' + errors.join('\n');
                }
            }
            alert(message);
        }

        function updatePlaylist() {
            const playlistEl = document.getElementById('playlist');
            playlistEl.innerHTML = '';
            
            playlist.forEach((track, index) => {
                const item = document.createElement('div');
                item.className = 'playlist-item' + (index === currentTrackIndex ? ' active' : '');
                
                const objktUrl = `https://objkt.com/tokens/${track.contract}/${track.tokenId}`;
                
                // Add delete button
                const deleteBtn = document.createElement('span');
                deleteBtn.innerHTML = '‚úï';
                deleteBtn.className = 'delete-btn';
                deleteBtn.onclick = (e) => {
                    e.stopPropagation();
                    removeTrack(index);
                };
                
                item.innerHTML = `
                    <div class="playlist-item-title"><a href="${objktUrl}" target="_blank" title="View on Objkt" onclick="event.stopPropagation()">${track.title}</a></div>
                    <div class="playlist-item-artist">${track.artist}</div>
                `;
                
                // Make item clickable to play track (but not the link itself)
                item.onclick = (e) => {
                    if (e.target.tagName !== 'A') {
                        currentTrackIndex = index;
                        loadTrack(index);
                        play();
                        savePlaylistToStorage();
                    }
                };
                
                item.appendChild(deleteBtn);
                playlistEl.appendChild(item);
            });
        }

        function removeTrack(index) {
            if (confirm('Remove this track from playlist?')) {
                playlist.splice(index, 1);
                
                // Update current track index
                if (currentTrackIndex === index) {
                    if (playlist.length > 0) {
                        currentTrackIndex = Math.min(currentTrackIndex, playlist.length - 1);
                        loadTrack(currentTrackIndex);
                    } else {
                        currentTrackIndex = -1;
                        document.getElementById('trackTitle').textContent = 'Ready to play';
                        document.getElementById('trackArtist').textContent = 'Add Objkt NFT link to begin';
                        pause();
                    }
                } else if (index < currentTrackIndex) {
                    currentTrackIndex--;
                }
                
                updatePlaylist();
                updateStatus();
                savePlaylistToStorage();
            }
        }

        function loadTrack(index) {
            if (index < 0 || index >= playlist.length) return;
            
            const track = playlist[index];
            
            // ALWAYS use audio player - it handles both audio and video files
            // The video element extracts audio automatically via Web Audio API
            audioPlayer.pause();
            audioPlayer.src = track.url;
            activePlayer = audioPlayer;
            
            // Create Objkt URL
            const objktUrl = `https://objkt.com/tokens/${track.contract}/${track.tokenId}`;
            
            // Make title clickable
            document.getElementById('trackTitle').innerHTML = `<a href="${objktUrl}" target="_blank" title="View on Objkt">${track.title}</a>`;
            document.getElementById('trackArtist').textContent = track.artist;
            
            updatePlaylist();
            updateMediaSession(); // Update lock screen controls
            savePlaylistToStorage(); // Save current track position
        }

        function togglePlay() {
            if (playlist.length === 0) {
                alert('Add tracks to your playlist first!');
                return;
            }

            if (isPlaying) {
                pause();
            } else {
                play();
            }
        }

        function play() {
            initAudioContext();
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
            
            activePlayer.play();
            isPlaying = true;
            playBtn.innerHTML = '‚è∏';
            document.getElementById('led1').classList.remove('off');
            startVisualizer();
            updateMediaSession();
        }

        function pause() {
            activePlayer.pause();
            isPlaying = false;
            playBtn.innerHTML = '‚ñ∂';
            document.getElementById('led1').classList.add('off');
        }

        function nextTrack() {
            if (playlist.length === 0) return;
            
            currentTrackIndex = (currentTrackIndex + 1) % playlist.length;
            loadTrack(currentTrackIndex);
            
            if (isPlaying) {
                play();
            }
        }

        function previousTrack() {
            if (playlist.length === 0) return;
            
            currentTrackIndex = (currentTrackIndex - 1 + playlist.length) % playlist.length;
            loadTrack(currentTrackIndex);
            
            if (isPlaying) {
                play();
            }
        }

        function updateStatus() {
            const status = document.getElementById('status');
            if (playlist.length === 0) {
                status.textContent = 'Playlist empty';
            } else {
                status.textContent = `${playlist.length} track${playlist.length > 1 ? 's' : ''} loaded`;
            }
        }

        // Audio/Video event listeners
        function setupPlayerListeners(player) {
            player.addEventListener('timeupdate', () => {
                const progress = (player.currentTime / player.duration) * 100;
                progressBar.style.width = progress + '%';
                
                // Update media session position for lock screen scrubber
                if ('mediaSession' in navigator && 'setPositionState' in navigator.mediaSession) {
                    try {
                        navigator.mediaSession.setPositionState({
                            duration: player.duration || 0,
                            playbackRate: player.playbackRate,
                            position: player.currentTime || 0
                        });
                    } catch (error) {
                        // Ignore errors (happens when duration not ready)
                    }
                }
            });

            player.addEventListener('ended', () => {
                // If there's only one track, reset to beginning
                if (playlist.length === 1) {
                    player.currentTime = 0;
                    pause();
                } else {
                    nextTrack();
                }
            });

            player.addEventListener('error', (e) => {
                console.error('Playback error:', e);
                alert('Error playing media. The file might be unavailable or in an unsupported format.');
            });
            
            // Update media session when metadata loads
            player.addEventListener('loadedmetadata', () => {
                updateMediaSession();
            });
        }

        setupPlayerListeners(audioPlayer);

        // Allow Enter key to add tracks
        document.getElementById('nftInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addTrack();
            }
        });

        // Featured Playlists Data - Admin panel will add playlists here
        const featuredPlaylists = [
            {
                name: "Sample Playlist",
                curator: "Flex",
                tracks: [
                    "https://objkt.com/tokens/hicetnunc/874565",
                    "https://objkt.com/tokens/KT1KPV5bfcw6YoNqy6aKr9xxBKzX9Zjoot38/129",
                    "https://objkt.com/tokens/KT1F42ppKYxzambBgxvVt68He8RTT9bXoNVT/1",
                    "https://objkt.com/tokens/KT1CBDCBPDGD3VvXWZqBcAMw73gGn2GnQEmX/9",
                    "https://objkt.com/tokens/KT1F42ppKYxzambBgxvVt68He8RTT9bXoNVT/2",
                    "https://objkt.com/tokens/KT1U8C31zT2pB1jGV1RrFRQT5hoQ5jKZKp2c/4",
                    "https://objkt.com/tokens/KT1Pt6muka2vEUnrsRFEomYsR5Mv2YZkQVrZ/66"
                ]
            }
        ];

        function toggleFeatured() {
            const featuredDiv = document.getElementById('featuredPlaylists');
            const toggleBtn = document.getElementById('featuredToggleBtn');
            
            if (featuredDiv.style.display === 'none') {
                featuredDiv.style.display = 'block';
                toggleBtn.textContent = '‚ûñ Featured Playlists';
                loadFeaturedPlaylists();
            } else {
                featuredDiv.style.display = 'none';
                toggleBtn.textContent = '‚≠ê Featured Playlists';
            }
        }

        function loadFeaturedPlaylists() {
            const container = document.getElementById('featuredPlaylists');
            container.innerHTML = '';
            
            if (featuredPlaylists.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: rgba(255, 215, 0, 0.5); font-size: 11px;">No featured playlists yet. Submit yours!</div>';
                return;
            }
            
            featuredPlaylists.forEach((playlist, index) => {
                const item = document.createElement('div');
                item.className = 'featured-playlist-item';
                
                item.innerHTML = `
                    <div class="featured-playlist-name">${playlist.name}</div>
                    <div class="featured-playlist-curator">Curated by ${playlist.curator}</div>
                    <div class="featured-playlist-count">${playlist.tracks.length} tracks</div>
                    <button class="copy-playlist-btn" onclick="copyPlaylistToClipboard(${index})">üìã Copy Playlist</button>
                `;
                
                container.appendChild(item);
            });
        }

        function copyPlaylistToClipboard(playlistIndex) {
            const playlist = featuredPlaylists[playlistIndex];
            const playlistText = playlist.tracks.join('\n');
            
            navigator.clipboard.writeText(playlistText).then(() => {
                alert(`‚úÖ "${playlist.name}" copied to clipboard!\n\nNow paste into Bulk Add to load all tracks.`);
            }).catch(err => {
                // Fallback for older browsers
                const textarea = document.createElement('textarea');
                textarea.value = playlistText;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert(`‚úÖ "${playlist.name}" copied to clipboard!\n\nNow paste into Bulk Add to load all tracks.`);
            });
        }

        async function discoverRandomMusic() {
            const btn = document.getElementById('randomDiscoveryBtn');
            btn.disabled = true;
            btn.textContent = 'üé≤ Discovering...';
            
            try {
                // Query Objkt.com API for random audio NFTs
                // Using a random offset to get different results each time
                const randomOffset = Math.floor(Math.random() * 500);
                const limit = 500; // Fetch 500 for maximum variety
                
                const response = await fetch(`https://data.objkt.com/v3/graphql`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        query: `query GetAudioTokens {
                            token(
                                where: {
                                    mime: {_eq: "audio/mpeg"}
                                },
                                limit: ${limit},
                                offset: ${randomOffset},
                                order_by: {pk: desc}
                            ) {
                                token_id
                                fa_contract
                                name
                                mime
                            }
                        }`
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Failed to fetch from Objkt API');
                }
                
                const data = await response.json();
                console.log('API response:', data); // Debug logging
                
                const tokens = data.data?.token || data.data?.tokens || [];
                
                if (!tokens || tokens.length === 0) {
                    console.error('No tokens found in response:', data);
                    alert('No audio NFTs found. Try again!');
                    return;
                }
                
                // Clear current playlist
                playlist = [];
                currentTrackIndex = -1;
                updatePlaylist();
                savePlaylistToStorage();
                
                // Load random tracks
                const loading = document.getElementById('loading');
                loading.classList.add('active');
                
                let successCount = 0;
                const maxTracks = 100; // Load max 100 random tracks
                
                // Shuffle and take subset
                const shuffled = tokens.sort(() => Math.random() - 0.5).slice(0, maxTracks);
                
                for (let i = 0; i < shuffled.length; i++) {
                    const token = shuffled[i];
                    const url = `https://objkt.com/tokens/${token.fa_contract}/${token.token_id}`;
                    
                    loading.textContent = `LOADING ${i + 1}/${shuffled.length}...`;
                    
                    try {
                        const trackData = await fetchNFTData(url);
                        
                        // Filter out sound effects by checking duration
                        // Skip tracks shorter than 90 seconds (likely sound effects)
                        if (trackData.duration && trackData.duration < 90) {
                            console.log(`Skipping short track: ${trackData.name} (${trackData.duration}s)`);
                            continue;
                        }
                        
                        playlist.push(trackData);
                        successCount++;
                        
                        // Stop if we have enough tracks
                        if (successCount >= 100) {
                            break;
                        }
                    } catch (error) {
                        console.error(`Failed to load ${url}:`, error);
                    }
                    
                    // Small delay to avoid rate limiting
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
                
                loading.classList.remove('active');
                loading.textContent = 'LOADING TRACK DATA...';
                
                updatePlaylist();
                
                if (playlist.length > 0) {
                    currentTrackIndex = 0;
                    loadTrack(0);
                    alert(`üé≤ Loaded ${successCount} random tracks!`);
                } else {
                    alert('No tracks could be loaded. Try again!');
                }
                
                updateStatus();
                savePlaylistToStorage();
                
            } catch (error) {
                console.error('Discovery error:', error);
                alert('Failed to discover music. Please try again!');
            } finally {
                btn.disabled = false;
                btn.textContent = 'üé≤ Discover Random Music';
            }
        }

        function clearAllTracks() {
            if (playlist.length === 0) {
                alert('Playlist is already empty!');
                return;
            }
            
            if (confirm(`Clear all ${playlist.length} track${playlist.length > 1 ? 's' : ''} from your playlist?`)) {
                playlist = [];
                currentTrackIndex = -1;
                isPlaying = false;
                
                audioPlayer.pause();
                audioPlayer.src = '';
                
                document.getElementById('trackTitle').textContent = 'Ready to play';
                document.getElementById('trackArtist').textContent = 'Add Objkt NFT link to begin';
                document.getElementById('playBtn').innerHTML = '‚ñ∂';
                document.getElementById('led1').classList.add('off');
                document.getElementById('progressBar').style.width = '0%';
                
                updatePlaylist();
                updateStatus();
                savePlaylistToStorage();
                
                alert('‚úÖ Playlist cleared!');
            }
        }

        function openSubmitForm() {
            // Your Airtable form URL
            const formUrl = 'https://airtable.com/appMgBEe1gf7U8uji/pagN8xlyOY8dVKlfg/form';
            
            if (confirm('üìù Submit Your Playlist!\n\nWant your curated playlist featured on TEZ FM?\n\nThis will open a form to submit your playlist.\n\nClick OK to continue.')) {
                window.open(formUrl, '_blank');
            }
        }

        // Load saved playlist on page load
        loadPlaylistFromStorage();

        // Keep audio playing when page is hidden (background playback)
        document.addEventListener('visibilitychange', () => {
            if (document.hidden && isPlaying) {
                // Ensure audio context stays active
                if (audioContext && audioContext.state === 'suspended') {
                    audioContext.resume();
                }
            }
        });

        // Resume audio context when coming back to foreground
        window.addEventListener('pageshow', (event) => {
            if (audioContext && audioContext.state === 'suspended') {
                audioContext.resume();
            }
        });

        // Fix mobile paste - preserve line breaks
        const bulkInput = document.getElementById('bulkInput');
        if (bulkInput) {
            bulkInput.addEventListener('paste', (e) => {
                e.preventDefault();
                const pastedText = (e.clipboardData || window.clipboardData).getData('text');
                const cursorPos = bulkInput.selectionStart;
                const textBefore = bulkInput.value.substring(0, cursorPos);
                const textAfter = bulkInput.value.substring(bulkInput.selectionEnd);
                bulkInput.value = textBefore + pastedText + textAfter;
                bulkInput.selectionStart = bulkInput.selectionEnd = cursorPos + pastedText.length;
            });
        }

        // Start visualizer even when paused for aesthetic
        drawVisualizer();
    </script>
</body>
</html>
